[Yesterday 17:32] Neela Bowmi
name: CI/CD workflow for Maven Build and Sonar Code scan

on:

  push:

    branches:

      - main

  workflow_dispatch:

jobs:

  build:

    runs-on: ubuntu-latest

    steps:

    - name: Checkout code

      uses: actions/checkout@v2
 
    - name: Set up JDK 11

      uses: actions/setup-java@v2

      with:

        distribution: 'adopt'

        java-version: '11'
 
    - name: Build with Maven

      run: mvn clean install -f MyWebApp/pom.xml
 
    - name: Start SonarQube container

      run: |

        docker run -d --name sonar -p 9000:9000 sonarqube:latest

        # Wait for SonarQube to be fully up and running

        until curl -s http://localhost:9000; do sleep 5; done
 
    - name: SonarQube Scan

      uses: sonarsource/sonarqube-scan-action@master

      with:

        projectBaseDir: .

        args: >

          -Dsonar.organization=my-org

          -Dsonar.projectKey=my-Java-web-app

      env:

        SONAR_TOKEN: ${{ secrets.squ_f200c98aff319b0b278f6d49448a9a4984e80a40 }}

        SONAR_HOST_URL: 'https://bowmi.someli/sonar'

 
